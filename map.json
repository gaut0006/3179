{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 700,
  
  

  "projection": {
    "type": "mercator",
    "center": [133, -30],
    "scale": 850,
    "translate": [400, 340]
  },

  "data": {
    "url": "https://raw.githubusercontent.com/gaut0006/3179/refs/heads/main/STE_2021_AUST_GDA94%20(3)-2.json",
    "format": { "type": "topojson", "feature": "STE_2021_AUST_GDA94 (3)" }
  },

  "transform": [
    { "calculate": "trim(datum.properties.STE_NAME21)", "as": "state_name" },
    {
      "lookup": "state_name",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/gaut0006/3179/refs/heads/main/Prevalence_by_state_year%20and%20deaths%20-%20prevalence_by_state_year%20and%20deaths%20(1).csv",
          "format": { "type": "csv" }
        },
        "key": "state",
        "fields": ["year", "metric", "value"]
      }
    },
    { "filter": "datum.metric == 'alcohol_induced_deaths_rate_per_100k'" },
    { "calculate": "toNumber(datum.year)", "as": "year_num" },
    { "filter": "datum.year_num == 2019" },
    { "calculate": "toNumber(datum.value)", "as": "value_num" },
    { "filter": "isValid(datum.value_num) && isFinite(datum.value_num)" }
  ],

  "params": [
    {
      "name": "minRate",
      "value": 0,
      "bind": { "input": "number", "name": "Min deaths/100k: ", "min": 0, "max": 20, "step": 0.1 }
    },
    {
      "name": "hoverState",
      "select": { "type": "point", "fields": ["state_name"] }
    },
    {
      "name": "pickState",
      "select": { "type": "point", "fields": ["state_name"], "on": "click", "clear": "dblclick" }
    }
  ],

  "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 1.2 },

  "encoding": {
    "color": {
      "field": "value_num",
      "type": "quantitative",
      "title": "Alcohol-Induced Deaths (per 100k)",
      "scale": { "scheme": "lighttealblue", "domain": [2.5, 10] },
      "legend": {
        "title": "Deaths per 100k",
        "orient": "right",
        "direction": "vertical",
        "offset": 10,
        "gradientLength": 250,
        "labelFontSize": 12,
        "titleFontSize": 13,
      "format": ".1f"
      }
    },

    "opacity": {
      "condition": { "test": "datum.value_num >= minRate", "value": 1 },
      "value": 0.25
    },

    "stroke": {
      "condition": [
        { "param": "pickState",  "empty": false, "value": "#111" },
        { "param": "hoverState", "empty": false, "value": "#333" }
      ],
      "value": "white"
    },
    "strokeWidth": {
      "condition": [
        { "param": "pickState",  "empty": false, "value": 2 },
        { "param": "hoverState", "empty": false, "value": 1.6 }
      ],
      "value": 1.2
    },

    "tooltip": [
      { "field": "state_name", "title": "State" },
      { "field": "value_num", "title": "Deaths per 100k", "format": ".1f" }
    ]
  },

  "config": {
    "autosize": { "type": "fit", "contains": "padding" },
    "padding": { "top": 40, "bottom": 20 },
    "background": "#f5f6fa",
    "view": { "stroke": "transparent" },
    "style": {
      "guide-label": { "font": "Inter" },
      "guide-title": { "font": "Inter" }
    }
  }
}