{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": 900,
  "height": 560,
  "title": {"text": "Alcohol-attributable share of total mortality(2019)",
  "subtitle": "% of all deaths that are due to alcohol (country-level)",
  "anchor": "start",
   "anchor": "middle","fontSize": 24,
   "subtitleFontSize": 14,
  "subtitleColor": "#555",
  "fontWeight": "bold",
  "font": "Helvetica Neue"},

  "data": {
    "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/ne_110m_admin_0_countries.topojson",
    "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
  },

  "transform": [
    {
      "lookup": "properties.ADM0_A3",
      "from": {
        "data": {"url": "https://raw.githubusercontent.com/gaut0006/3179/refs/heads/main/alcohol-attributable-fraction-of-mortality.csv"},
        "key": "Code",
        "fields": ["Entity", "Code", "Year", "Alcohol_attributable_deaths"]
      }
    },
    {"calculate": "toNumber(datum.Alcohol_attributable_deaths)", "as": "deaths_num"},
    {
      "calculate": "isValid(datum.deaths_num) ? (datum.deaths_num < 2 ? '0--2' : datum.deaths_num < 4 ? '2-4' : datum.deaths_num < 6 ? '4-6' : datum.deaths_num < 8 ? '6-8' : datum.deaths_num < 10 ? '8-10' : '10+') : null",
      "as": "bin_label"
    }
  ],

  "projection": {"type": "equalEarth"},

  "params": [
    {"name": "minPick", "value": 0, "bind": {"input": "number", "name": "Min deaths: "}},
    {"name": "maxPick", "value": 100, "bind": {"input": "number", "name": "Max deaths: "}},
    {
      "name": "countryISO",
      "value": "",
      "bind": {
        "input": "select",
        "name": "Highlight country: ",
        "options": ["", "AUS","IND","USA","CHN","RUS","BRA","ZAF","CAN","GBR","DEU","FRA","ITA","JPN","MEX","IDN","ESP","TUR","KOR","SAU","ARG","NLD"],
        "labels": [" All ","Australia (AUS)","India (IND)","United States (USA)","China (CHN)","Russia (RUS)","Brazil (BRA)","South Africa (ZAF)","Canada (CAN)","United Kingdom (GBR)","Germany (DEU)","France (FRA)","Italy (ITA)","Japan (JPN)","Mexico (MEX)","Indonesia (IDN)","Spain (ESP)","TÃ¼rkiye (TUR)","South Korea (KOR)","Saudi Arabia (SAU)","Argentina (ARG)","Netherlands (NLD)"]
      }
    }
  ],

  "layer": [
    
    {
      "transform": [{"filter": "!isValid(datum.deaths_num)"}],
      "mark": {"type": "geoshape", "stroke": null, "fill": "#f2f2f2", "opacity": 0.6}
    },

   
    {
      "transform": [{"filter": "isValid(datum.deaths_num)"}],
      "mark": {"type": "geoshape", "stroke": null},
      "encoding": {
        "color": {
          "field": "bin_label",
          "type": "nominal",
          "title": "Deaths (2019)",
          "scale": {
            "domain": ["0-2","2--4","4-6","6-8","8-10","10+"],
            "range": ["#ffd54f","#fdbb6e","#fda762","#F7673A","#ef3b2c","#d7301f"]
          },
          "legend": {"orient": "bottom"}
        },
        "opacity": {
          "condition": {"test": "datum.deaths_num >= minPick && datum.deaths_num <= maxPick", "value": 1},
          "value": 0.25
        },
        "tooltip": [
          {"field": "Entity", "type": "nominal", "title": "Country"},
          {"field": "Code", "type": "nominal", "title": "ISO-3"},
          {"field": "deaths_num", "type": "quantitative", "title": "Deaths", "format": ","}
        ]
      }
    },

    
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "mesh": "ne_110m_admin_0_countries"}
      },
      "mark": {"type": "geoshape", "fill": null, "stroke": "#dcdcdc", "strokeWidth": 0.06, "strokeOpacity": 0.9}
    },

    
    {
      "mark": {"type": "geoshape", "fill": null},
      "encoding": {
        "stroke": {"condition": {"test": "length(countryISO) && datum.Code == countryISO", "value": "#111"}, "value": null},
        "strokeWidth": {"condition": {"test": "length(countryISO) && datum.Code == countryISO", "value": 1.2}, "value": 0}
      }
    }
  ],

  "config": {"view": {"stroke": null}, "background": "floralwhite"}
}